
function PropertiesUI(owner){this.owner=owner;var obj=this;var _collapse=document.getElementById(this.owner.name+"_props_collapse");utility.dom.attachEvent(_collapse,'click',function(e){obj.toggleCurrentPI();});_collapse=null;this.name=owner.name;this.tooperate='';this.isLoaded=false;this.taglist=['a','anchor','embed_flash','embed_wmedia','embed_quicktime','img','ol','ul','li','hr','fieldset','label','input_text','input_filefield','input_hidden','input_button','input_checkbox','input_radio','listmenu','table','tr','td','form'];this.none='Properties_none_'+this.name;for(var i=0;i<this.taglist.length;i++){this[this.taglist[i]]='Properties_'+this.taglist[i]+'_'+this.owner.name;this[this.taglist[i]+'_test']=eval('PropertiesUI_'+this.taglist[i]+'_test');}
this.currentPI=this.owner.ui.toolbar?'none':'none';this.updateColapseButton();}
PropertiesUI.prototype.updateColapseButton=function(state){var name_collapse=this.owner.name+'_props_collapse';var collapser=document.getElementById(name_collapse);if(typeof piName=='undefined'){var piName=this.currentPI;};var name='Properties_'+piName+'_'+this.owner.name;var displayDiv=document.getElementById(name);if(!displayDiv){return;};var outerTable=displayDiv;while(String(outerTable.tagName).toLowerCase()!='table'){outerTable=outerTable.parentNode;};var ARMP=document.getElementById("ARMP");var expanded_width=Math.max(displayDiv.scrollWidth,displayDiv.parentNode.scrollWidth);if(ARMP){expanded_width=Math.min(Math.abs(expanded_width-3000),expanded_width);}
var colapsed_width=this.owner.piWidthRec;var new_visibility=(expanded_width>colapsed_width)?'visible':'hidden';if(collapser.style.visibility!=new_visibility){collapser.style.visibility=new_visibility;}};PropertiesUI.prototype.updatePItitle=function(new_title){var PI_outer_rec_name=this.name+'_PI';var PI_outer_rec=document.getElementById(PI_outer_rec_name);var _legend=PI_outer_rec.getElementsByTagName('legend')[0];_legend.innerHTML=new_title;}
if(typeof global_pi_widths=='undefined'){global_pi_widths={};}
PropertiesUI.prototype.showPI=function(piName){if(typeof piName=='undefined'){var piName=this.currentPI;}
if(typeof this.owner.pis[piName]=="undefined"){return;}
var div_name='Properties_'+piName+'_'+this.owner.name;var displayDiv=document.getElementById(div_name);var outerTable=displayDiv;var searchTag='fieldset';while(String(outerTable.tagName).toLowerCase()!=searchTag){outerTable=(outerTable===null)?displayDiv.parentNode:outerTable.parentNode;if(String(outerTable.tagName).toLowerCase()=='fieldset'){searchTag='table';};};var image=document.getElementById('logoKTML_'+this.owner.name);var name_collapse=this.owner.name+'_props_collapse';var collapser=document.getElementById(name_collapse);var ARMP=document.getElementById("ARMP");this.updateColapseButton();if(is.mozilla){if(!(Math.max(displayDiv.scrollWidth,displayDiv.parentNode.scrollWidth)>displayDiv.parentNode.offsetWidth)){return;}}else{if(!(displayDiv.scrollWidth>(outerTable.offsetWidth-24))){return;}}
if(typeof global_pi_widths[piName]=='undefined'){global_pi_widths[piName]=displayDiv.offsetWidth;}
outerTable.style.zIndex='10';var in_flow_position=utility.dom.getBox(outerTable).y;outerTable.style.position='absolute';var out_of_flow_position=utility.dom.getBox(outerTable).y;var delta1=out_of_flow_position-in_flow_position;if(delta1){outerTable.style.top=in_flow_position+'px';var moved_position=utility.dom.getBox(outerTable).y;var delta2=moved_position-in_flow_position;if(delta2){moved_position=(in_flow_position-delta2);outerTable.style.top=moved_position+'px';}}
var expanded_width=Math.max(displayDiv.scrollWidth,displayDiv.parentNode.scrollWidth);if(ARMP){expanded_width=Math.min(Math.abs(expanded_width-3000),expanded_width);}
outerTable.style.width=(expanded_width+41)+'px';displayDiv.style.width=expanded_width+'px';displayDiv.parentNode.style.width=expanded_width+'px';if(ARMP){if(displayDiv.offsetHeight>this.owner.piHeightRec){displayDiv.style.overflow='hidden';displayDiv.style.height=this.owner.piHeightRec+'px';}}
utility.dom.classNameRemove(collapser,'ktml_collapse_closed');utility.dom.classNameAdd(collapser,'ktml_collapse_open');outerTable=displayDiv=collapser=null;this.PI_IS_EXPANDED=true;};PropertiesUI.prototype.hidePI=function(piName){if(typeof piName=='undefined'){var piName=this.currentPI;}
if(typeof this.owner.pis[piName]=="undefined"){return;}
var div_name='Properties_'+piName+'_'+this.owner.name;var displayDiv=document.getElementById(div_name);var outerTable=displayDiv;var searchTag='fieldset';while(String(outerTable.tagName).toLowerCase()!=searchTag){outerTable=(outerTable===null)?displayDiv.parentNode:outerTable.parentNode;if(String(outerTable.tagName).toLowerCase()=='fieldset'){searchTag='table';}}
var image=document.getElementById('logoKTML_'+this.owner.name);var name_collapse=this.owner.name+'_props_collapse';var collapser=document.getElementById(name_collapse);var ARMP=document.getElementById("ARMP");var colapsed_width=this.owner.piWidthRec;displayDiv.style.width=this.owner.piWidthRec+'px';displayDiv.parentNode.style.width='';outerTable.style.width='';outerTable.style.zIndex='';displayDiv.style.position='';var out_of_flow_position=utility.dom.getBox(outerTable).y;outerTable.style.position='';var in_flow_position=utility.dom.getBox(outerTable).y;var delta=out_of_flow_position-in_flow_position;this.updateColapseButton();utility.dom.classNameRemove(collapser,'ktml_collapse_open');utility.dom.classNameAdd(collapser,'ktml_collapse_closed');outerTable=displayDiv=collapser=null;this.PI_IS_EXPANDED=false;};PropertiesUI.prototype.toggleCurrentPI=function(){if(this.PI_IS_EXPANDED){this.hidePI();}else{this.showPI();}};function PropertiesUI_intValue(el){try{var val=parseInt(el.value);if(isNaN(val)){el.value='';}else{el.value=val;}}catch(e){el.value='';}};function PropertiesUI_colorValue(el){try{var val=el.value;if(val==''||val.search(/^#[0-9abcdef]{0,6}$/i)!=-1){el.goodValue=val;}else{if(el.goodValue){el.value=el.goodValue;}else{el.value='';}}}catch(e){el.value='';}};PropertiesUI.prototype.clear=function(pi){if(typeof pi=='undefined'){pi=this.currentPI;}
if(typeof this.owner.pis[pi]=="undefined"){return;}
var tmp=document.getElementById("Properties_"+pi+"_"+this.owner.name);if(tmp){tmp.style.display='none';}
var i,tmp;for(i=0;i<this.taglist.length;i++){tmp=document.getElementById(this[this.taglist[i]]);if(tmp){tmp.style.display='none';}}};PropertiesUI.prototype.update=function(){if(this.owner.loadingPI==true||!this.owner.ui.pi||!this.owner.ui.toolbar){return;}
try{if(!this.PI_IS_EXPANDED){var _tmp_name="Properties_"+this.currentPI+"_"+this.owner.name;var _tmpObj=document.getElementById(_tmp_name);var PI_recipient=_tmpObj.parentNode;PI_recipient.style.overflow='hidden';PI_recipient.style.width=this.owner.piWidthRec+'px';}}catch(e){};var oldcurrentPI=this.currentPI;if(!(this.owner.selectableNodes&&this.owner.selectableNodes[0])){this.tooperate=null;}else{this.ctn=this.owner.selectableNodes[0].tagName.toLowerCase();if(this.owner.selectableNodes[0].parentElement){this.ptn=this.owner.selectableNodes[0].parentElement.tagName.toLowerCase();}else{this.ptn="none";}
try{for(var i=0;i<this.taglist.length;i++){var obj=this[this.taglist[i]+'_test']();if(obj){this.tooperate=obj;this.currentPI=this.taglist[i];break;}else{this.tooperate=null;}}}catch(e){}}
this.owner.inspectedNode=this.tooperate;if(!this.tooperate){this.currentPI='none';}
if(oldcurrentPI!=this.currentPI){this.hidePI(oldcurrentPI);this.clear(oldcurrentPI);var tmp=document.getElementById("Properties_"+this.currentPI+"_"+this.owner.name);if(tmp){tmp.style.display='';}
if(typeof this.owner.pis[this.currentPI]=="undefined"){this.owner.loadPropertyInspectorForTag(this.currentPI);return;}
if(this.owner.pis[this.currentPI].inspect){this.owner.pis[this.currentPI].inspect();}
var tmp=document.getElementById("Properties_"+this.currentPI+"_"+this.owner.name);if(tmp){if(this.currentPI=="none"){this.updatePItitle(translate('Properties',this.owner.config.UILanguage));}else{if(this.owner.pis[this.currentPI].PI_caption){this.updatePItitle(translate(this.owner.pis[this.currentPI].PI_caption),this.owner.config.UILanguage);}else{this.updatePItitle(translate('Properties',this.owner.config.UILanguage));}}
tmp.style.display='';}}else{if(this.owner.pis[this.currentPI].inspect){this.owner.pis[this.currentPI].inspect();}}
this.updateColapseButton();this.owner.ARMP_state=null;};function PropertiesUI_prop_getDimensions(el){if(el.style.width){if(el.style.pixelWidth){el.width=el.style.pixelWidth;}else{var str=el.style.width;el.width=str.substring(0,str.length-2);}
el.style.width='';}
if(el.style.height){if(el.style.pixelHeight){el.height=el.style.pixelHeight;}else{var str=el.style.height;el.height=str.substring(0,str.length-2);}
el.style.height='';}};PropertiesUI.prototype.apply=function(propName,propValue){if(this.owner.toolbar.checkHelp()){return true;};if(this.owner.selectableNodes&&this.owner.selectableNodes[0]&&this.owner.inspectedNode){if(this.owner.pis[this.currentPI]){this.owner.pis[this.currentPI].apply(propName,propValue);if(this.owner.undo){this.owner.undo.addEdit(false);}}}};PropertiesUI.prototype.chooseBgColor=function(element,idu){var _this=this;if(typeof this.owner.cpalette=='undefined'){var cpaletteSrc=window.KtmlRoot+'core/js/lib/colorpicker.js';KtmlIncludeJs(cpaletteSrc,function(){_this.owner.cpalette=new ColorPalette(_this.owner);_this.chooseBgColor.call(_this,element,idu);return;});return;}
if(this.owner.cpalette.isVisible){this.owner.cpalette.setVisible(false);}else{var pi=this;this.owner.cpalette.onSelect=function(new_value){document.getElementById(idu).value=new_value;pi.apply('bgColor',new_value);};this.owner.cpalette.setSelected(document.getElementById(idu).value);this.owner.cpalette.recalculateDimensions();this.owner.cpalette.showAtElement(element,'30');}
return false;};PropertiesUI.prototype.chooseBrdColor=function(element,idu){var _this=this;if(typeof this.owner.cpalette=='undefined'){var cpaletteSrc=window.KtmlRoot+'core/js/lib/colorpicker.js';KtmlIncludeJs(cpaletteSrc,function(){_this.owner.cpalette=new ColorPalette(_this.owner);_this.chooseBrdColor.call(_this,element,idu);return;});return;}
if(this.owner.cpalette.isVisible){this.owner.cpalette.setVisible(false);}else{var pi2=this;this.owner.cpalette.onSelect=function(new_value){document.getElementById(idu).value=new_value;pi2.apply('borderColor',new_value);};this.owner.cpalette.setSelected(document.getElementById(idu).value);this.owner.cpalette.recalculateDimensions();this.owner.cpalette.showAtElement(element,'30');}
return false;};function introspection_showhelp(objectName,el,type,event,block){if(window['ktml_'+objectName].toolbar.checkHelp(el,event)){window['ktml_'+objectName].toolbar.showHelp(type);return false;}else{if(typeof block=='function'){block(el);return false;}else{return true;}}};function introspection_showhelp2(idx,event){var o=utility.dom.setEventVars(event);if(ktmls[idx].toolbar.checkHelp(null,o.e)){utility.dom.stopEvent(o.e);var tid=o.targ.getAttribute("help_topic_id");if(tid){ktmls[idx].toolbar.showHelp(tid);}
return false;}};function Introspection_toggleAdvanced(name,pi_id,state){var pi,STATE,toggle_only,pannels=[];var ktmlObj=window['ktml_'+name];pi=ktmlObj.pis[pi_id];STATE=pi.ARMP_state||'simple';var pi_div=document.getElementById('Properties_'+pi_id+'_'+name);var ARMP=null;var tmp_tables=pi_div.getElementsByTagName('TABLE');for(var i=0;i<tmp_tables.length;i++){if(tmp_tables[i].id=='ARMP'){ARMP=tmp_tables[i];break;}}
if(!ARMP){return;}
var _tmpChilds;var _tmpRows=ARMP.rows;for(var z=0;z<_tmpRows.length;_tmpRows++){var _tmpTDs=_tmpRows[z].cells;for(var x=0;x<_tmpTDs.length;x++){_tmpChilds=_tmpTDs[x].childNodes;for(var y=0;y<_tmpChilds.length;y++){if(_tmpChilds[y].nodeType!=1){continue;}
if(_tmpChilds[y].nodeName.toLowerCase()=='div'){pannels.push(_tmpChilds[y]);}}}}
var tmp_obj={};tmp_obj['length']=0;Array_each(pannels,function(pannelRecipient){try{var pannel_name=pannelRecipient.id.match(/_props_(\w*)_/i)[1];tmp_obj[pannel_name]=pannelRecipient;tmp_obj['length']+=1;}catch(e){}});if(tmp_obj.length==pannels.length){pannels=tmp_obj;}else{if(KtmlDevelopment){alert("Please check that all your pannels within this ARMP PI have proper IDs!");}
return;};toggle_only=(pannels.length==2)?true:false;var target_pannel=(toggle_only)?(STATE=='simple')?'advanced':'simple':(state)?state.toLowerCase():'simple';pi.ARMP_state=target_pannel;var CURRENT,CURRENT_btn,TARGET,TARGET_btn,tmp_str;tmp_str='Properties_'+pi_id+'_props_'+STATE+'_'+ktmlObj.name;CURRENT=document.getElementById(tmp_str);tmp_str='Properties_'+pi_id+'_props_'+STATE+'_btn_'+ktmlObj.name;CURRENT_btn=document.getElementById(tmp_str);tmp_str='Properties_'+pi_id+'_props_'+target_pannel+'_'+ktmlObj.name;TARGET=document.getElementById(tmp_str);tmp_str='Properties_'+pi_id+'_props_'+target_pannel+'_btn_'+ktmlObj.name;TARGET_btn=document.getElementById(tmp_str);CURRENT_btn.style.display='none';TARGET_btn.style.display='';TARGET_btn.focus();CURRENT.style.display='none';TARGET.style.display='';ktmlObj.ARMP_state=target_pannel;};function PropertiesUI_a_test(){var tn=this.ctn;if(/img/i.test(tn)){return false;}
var parA=utility.dom.getParentByTagName(this.owner.selectableNodes[0],"A");if(parA){return parA;}
return false;};function PropertiesUI_anchor_test(){var tn=this.ctn;if(/img/i.test(tn)&&this.owner.selectableNodes[0].getAttribute("orig")){var translatorFor=(this.owner.selectableNodes[0].getAttribute("for")+"").toLowerCase();if(translatorFor=="anchor"){return this.owner.selectableNodes[0];}}
return false;};function PropertiesUI_img_test(){if(this.ctn=='img'){if(this.owner.selectableNodes[0].getAttribute("orig")){return false;}
return this.owner.selectableNodes[0];}
return false;};function PropertiesUI_li_test(){if(this.ptn!="ol"&&this.ptn!="ul"){return false;}
if(this.ctn=='li')return this.owner.selectableNodes[0];return false;};function PropertiesUI_ol_test(){if(this.ctn=='ol')return this.owner.selectableNodes[0];return false;};function PropertiesUI_ul_test(){if(this.ctn=='ul')return this.owner.selectableNodes[0];return false;};function PropertiesUI_hr_test(){if(this.ctn=='hr')return this.owner.selectableNodes[0];return false;};function PropertiesUI_table_test(){if(this.ctn=='table')return this.owner.selectableNodes[0];return false;};function PropertiesUI_tr_test(){if(this.ctn=='tr')return this.owner.selectableNodes[0];return false;};function PropertiesUI_td_test(){if(this.ctn=='td'||this.ctn=='th'){return this.owner.selectableNodes[0];}else{var i=0;while(i<this.owner.selectableNodes.length){if(this.owner.selectableNodes[i].tagName.toLowerCase()=='a'){return false;}
if(this.owner.selectableNodes[i].tagName.toLowerCase()=='td'||this.owner.selectableNodes[i].tagName.toLowerCase()=='th'){return this.owner.selectableNodes[i];}
i++;}}
return false;};function PropertiesUI_embed_flash_test(){var tn=this.ctn;if(/img/i.test(tn)&&this.owner.selectableNodes[0].getAttribute("orig")){var translatorFor=(this.owner.selectableNodes[0].getAttribute("for")+"").toLowerCase();if(translatorFor=="flashmovie"){return this.owner.selectableNodes[0];}}
if(tn=="embed"){var tt=(this.owner.selectableNodes[0].attributes.getNamedItem("type").value+"").toLowerCase();if(tt=="application/x-shockwave-flash"){return this.owner.selectableNodes[0]}}
return false;};function PropertiesUI_embed_wmedia_test(){var tn=this.ctn;if(/img/i.test(tn)&&this.owner.selectableNodes[0].getAttribute("orig")){var translatorFor=(this.owner.selectableNodes[0].getAttribute("for")+"").toLowerCase();if(translatorFor=="windowsmedia"){return this.owner.selectableNodes[0];}}
if(tn=="embed"){var tt=(this.owner.selectableNodes[0].attributes.getNamedItem("type").value+"").toLowerCase();if(tt=="video/x-ms-asf"){return this.owner.selectableNodes[0]}}
return false;};function PropertiesUI_embed_quicktime_test(){var tn=this.ctn;if(/img/i.test(tn)&&this.owner.selectableNodes[0].getAttribute("orig")){var translatorFor=(this.owner.selectableNodes[0].getAttribute("for")+"").toLowerCase();if(translatorFor=="quicktime"){return this.owner.selectableNodes[0];}}
if(tn=="embed"){var tt=(this.owner.selectableNodes[0].attributes.getNamedItem("type").value+"").toLowerCase();if(tt=="video/quicktime"){return this.owner.selectableNodes[0]}}
return false;};function PropertiesUI_form_test(){var parForm=utility.dom.getParentByTagName(this.owner.selectableNodes[0],"FORM");if(parForm){return parForm;}
return false;};function PropertiesUI_fieldset_test(){if(this.ctn=='fieldset')return this.owner.selectableNodes[0];return false;};function PropertiesUI_label_test(){if(this.ctn=='label')return this.owner.selectableNodes[0];return false;};function PropertiesUI_input_text_test(){var inputType=(this.owner.selectableNodes[0].type+"").toLowerCase();var tagName=this.ctn;if(tagName=='input'&&(inputType=='text'||inputType=='password')||tagName=='textarea')return this.owner.selectableNodes[0];return false;};function PropertiesUI_input_hidden_test(){var tn=this.ctn;if(/img/i.test(tn)&&this.owner.selectableNodes[0].getAttribute("orig")){var translatorFor=(this.owner.selectableNodes[0].getAttribute("for")+"").toLowerCase();if(translatorFor=="hidden"){return this.owner.selectableNodes[0];}}
var tagName=this.ctn;var inputType=(this.owner.selectableNodes[0].type+"").toLowerCase();if(tagName=='input'&&(inputType=='hidden'))return this.owner.selectableNodes[0];return false;};function PropertiesUI_input_filefield_test(){var inputType=(this.owner.selectableNodes[0].type+"").toLowerCase();var tagName=this.ctn;if(tagName=='input'&&(inputType=='file'))return this.owner.selectableNodes[0];return false;};function PropertiesUI_input_checkbox_test(){var inputType=(this.owner.selectableNodes[0].type+"").toLowerCase();var tagName=this.ctn;if(tagName=='input'&&inputType=='checkbox')return this.owner.selectableNodes[0];return false;};function PropertiesUI_input_radio_test(){var inputType=(this.owner.selectableNodes[0].type+"").toLowerCase();var tagName=this.ctn;if(tagName=='input'&&inputType=='radio')return this.owner.selectableNodes[0];return false;};function PropertiesUI_listmenu_test(){var tagName=this.ctn;if(tagName=='select')return this.owner.selectableNodes[0];return false;};function PropertiesUI_input_button_test(){var sn=this.owner.selectableNodes[0];var st=(sn.type+"").toLowerCase();if(sn.tagName.toLowerCase()=='input'&&(st=='button'||st=="submit"||st=="reset"))return sn;return false;};ktml.prototype.addPI=function(kind,piName,piHTML){if(this.piloader){this.piloader.location.replace(window.KtmlRoot+"core/htm/blank.html");}else{return;}
this.pis[kind]=1;var div=document.getElementById(this.name+"_props").getElementsByTagName('div')[0];div.innerHTML+=piHTML.replace(/ssrc=/gi,"src=");utility.dom.setUnselectable(div);var _legend=document.getElementById(this.name+"_props").getElementsByTagName('legend')[0];_legend.innerHTML=piName;var allInputs=div.getElementsByTagName('input');for(var i=0;i<allInputs.length;i++){allInputs[i].setAttribute("AutoComplete","off");}
if(typeof KtmlPIObjects[kind]!="undefined"){this.pis[kind]=new KtmlPIObjects[kind](this);this.pis[kind].PI_caption=piName;}
this.loadingPI=false;var for_tag_b=document.getElementById(this.name+"_forTag");if(for_tag_b){for_tag_b.innerHTML="";}
document.getElementById(this.name+"_LoadingPI").style.display="none";document.getElementById(this.name+"_props").parentNode.style.display="";var name='Properties_'+kind+'_'+this.name;var displayDiv=document.getElementById(name);this.introspector.update();};ktml.prototype.loadPropertyInspectorForTag=function(tagName){if(this.loadingPI||!this.ui.pi){return;}
if(!this.piloader){if(is.ie){this.piloader=document.frames(this.name+'_PropertyInspectorBuffer').window;}else{this.piloader=document.getElementById(this.name+'_PropertyInspectorBuffer').contentWindow;}}
var loading_tr=document.getElementById(this.name+"_LoadingPI");this.loadingPI=true;if(tagName!='none'){var for_tag_b=document.getElementById(this.name+"_forTag");if(!for_tag_b){var msg=translate('Loading the properties for the %s tag. Please wait...',this.config.UILanguage);msg=utility.string.sprintf(msg,'<b id="'+this.name+'_forTag">'+tagName+'</b>');loading_tr.cells[0].innerHTML=msg;for_tag_b=document.getElementById(this.name+"_forTag");}
for_tag_b.innerHTML=tagName;}else{loading_tr.cells[0].innerHTML=translate('Loading...',this.config.UILanguage);}
loading_tr.style.display="";document.getElementById(this.name+"_props").parentNode.style.display="none";var tagName=tagName.toLowerCase();var ktml_idx=this.counter;KtmlIncludeJs(window.KtmlRoot+"modules/introspection/tags/"+tagName+"/pi.js",function(){ktmls[ktml_idx].piloader.location.replace(window.KtmlRoot+"modules/introspection/tags/"+tagName+"/pi.htm"+'?ktmlname='+ktmls[ktml_idx].name);});};function fixFocusHack(){if(is.ie){if(event.srcElement.tagName=="SELECT"){var pel=event.srcElement;while(pel){if(pel.className=="introspector"){var inputTexts=pel.getElementsByTagName("INPUT");if(inputTexts.length==0){return;}
for(var i=0;i<inputTexts.length;i++){if(inputTexts[i].type=="text"&&!inputTexts[i].readOnly&&!inputTexts[i].disabled){inputTexts[i].focus();event.srcElement.focus();break;}}
break;}
pel=pel.parentElement;}}}};function introspection_runonce(){if(!window.KtmlPIObjects){window.KtmlPIObjects={};}};function introspection_runeach(k){if(typeof k['contextMenu']=='undefined'){window.setTimeout('introspection_runeach(ktmls['+k.counter+'])',200);return;}
k.pis={'none':'1'};k.introspector=new PropertiesUI(k);k.pis['none']=1;k.introspector.currentPI='none';Array_push(k.hooks['onupdatebuttonstate'],introspection_callback_update);Array_push(k.hooks['ondomselect'],introspection_callback_update);Array_push(k.hooks['onsetdisplaymode'],introspection_callback_clear);var copy_ICMI=Introspector_ContextMenuItems();for(var pi_id in copy_ICMI){KTStorage.get(k.contextMenu).addMenuItems(copy_ICMI[pi_id]);}
k.runHooks('ondomselect');};function introspection_callback_update(){this.introspector.update();};function introspection_callback_clear(){this.introspector.clear();};function util_safeSetFieldValue(inputId,propValue){var el=document.getElementById(inputId);var oldVal=null;switch(el.type){case"text":oldVal=el.value;break;default:break;}
propValue=(propValue!==null)?propValue.toString().replace(/\?size=\d+$/i,''):'';oldVal=oldVal||'';oldVal=(oldVal.toString()).replace(/\?size=\d+$/i,'');if(oldVal!=propValue){switch(el.type){case"text":el.value=propValue;break;default:break;}}};function util_checkMeasureUnit(el,max,noUnit){var ktmlObject=window.ktmls[getKTMLIndexFromElement(el)];var cond=true;var _pattern=noUnit?/^[0-9]*$/:/^[0-9]+/;if(!el.value.match(_pattern)){cond=false;text=translate("Invalid value",ktmlObject.config.UILanguage);}
if((typeof max=='number')&&(parseInt(el.value)>max)){cond=false;text=translate(KT_Messages["Value to big"],ktmlObject.config.UILanguage);text=utility.string.sprintf(text,max);}
if(el.value==""){cond=true;}
if(cond){return true;}else{alert(text);el.value='';ktmlObject.pis[ktmlObject.introspector.currentPI].inspect();return false;}};function Introspector_ContextMenuItems(){var ret={'td':[{"name":"-","show_if":"canMergeCells(window.ktmls[this.owner])","enable_if":"true"},{"name":"Merge Cells","action":"mergeCells(window.ktmls[this.owner])","show_if":"canMergeCells(window.ktmls[this.owner])","enable_if":"true","image":"core/img/increasecolspan.gif"},{"name":"Table Operations","action":"->","show_if":"checkMI(window.ktmls[this.owner])","enable_if":"true","image":"core/img/insert_table.gif","MenuItems":[{"name":"Increase Colspan","action":"mergeRight(window.ktmls[this.owner])","show_if":"true","enable_if":"true","image":"core/img/increasecolspan.gif"},{"name":"Increase Rowspan","action":"mergeDown(window.ktmls[this.owner])","show_if":"true","enable_if":"true","image":"core/img/increaserowspan.gif"},{"name":"Decrease Colspan","action":"splitCell(window.ktmls[this.owner])","show_if":"checkMI(window.ktmls[this.owner])","enable_if":"true","image":"core/img/decreasecolspan.gif"},{"name":"Decrease Rowspan","action":"unMergeDown(window.ktmls[this.owner])","show_if":"checkMI(window.ktmls[this.owner])","enable_if":"true","image":"core/img/decreaserowspan.gif"},{"name":"Add Column Before","action":"processColumn('add', window.ktmls[this.owner])","show_if":"checkMI(window.ktmls[this.owner])","enable_if":"true","image":"core/img/addcol.gif"},{"name":"Add Column After","action":"processColumn('add', window.ktmls[this.owner], 'after')","show_if":"checkMI(window.ktmls[this.owner])","enable_if":"true","image":"core/img/addcolafter.gif"},{"name":"Add Row Above","action":"processRow('add', window.ktmls[this.owner])","show_if":"checkMI(window.ktmls[this.owner])","enable_if":"true","image":"core/img/addrow.gif"},{"name":"Add Row Below","action":"processRow('add', window.ktmls[this.owner], 'after')","show_if":"checkMI(window.ktmls[this.owner])","enable_if":"true","image":"core/img/addrowafter.gif"},{"name":"Remove Column","action":"processColumn('remove', window.ktmls[this.owner])","show_if":"checkMI(window.ktmls[this.owner])","enable_if":"true","image":"core/img/removecol.gif"},{"name":"Remove Row","action":"processRow('remove', window.ktmls[this.owner])","show_if":"checkMI(window.ktmls[this.owner])","enable_if":"true","image":"core/img/removerow.gif"}]}],'img':[{"name":"-","show_if":"checkImageMI(window.ktmls[this.owner])","enable_if":"true"},{"name":"Edit Image","action":"window.ktmls[this.owner].openSelectFile({submode:'media', filter:'images', gotoImageEdit:true})","show_if":"checkImageMI(window.ktmls[this.owner])","enable_if":"testEditImage(window.ktmls[this.owner])","action_event":"mouseup","image":"core/img/insert_image.gif"},{"name":"Resize Image","action":"ContextMenu_resizeImage(window.ktmls[this.owner])","show_if":"checkImageMI(window.ktmls[this.owner])","enable_if":"testResizeImage(window.ktmls[this.owner])","image":"modules/filebrowser/img/resize.gif"}]};ret.td[0].show_if="checkMI(window.ktmls[this.owner]) || canMergeCells(window.ktmls[this.owner])";return ret;}
function checkMI(k){for(var i=0;i<k.selectableNodes.length;i++){var selNode=k.selectableNodes[i];if(selNode.tagName=="IMG"&&k.hasModule('filebrowser')){return false;}
if(selNode.tagName=="TD"||selNode.tagName=="TH"){return true;}}
return false;};function checkImageMI(k){if(k.toolbar.indexOfName('insert_image')>=0&&k.selectableNodes.length>0&&k.selectableNodes[0].tagName=="IMG"&&k.selectableNodes[0].getAttribute("orig")==null){if(k.hasModule('filebrowser')){return true;}}
return false;};function testEditImage(ktml){var url=ktml.getModuleProperty('media','UploadFolderUrl')||'';var selNode=ktml.logic_getSelectedNode();var ret=true&&selNode!=null;ret=ret&&selNode.nodeName=="IMG";ret=ret&&selNode.getAttribute("orig")==null;ret=ret&&selNode.src.indexOf(url)>=0;return ret;};function testResizeImage(ktml){var url=ktml.getModuleProperty('media','UploadFolderUrl')||'';var selNode=ktml.logic_getSelectedNode();var ret=true&&selNode!=null;ret=ret&&selNode.nodeName=="IMG";ret=ret&&selNode.getAttribute("orig")==null;ret=ret&&selNode.src.indexOf(url)>=0;ret=ret&&(/width=/i.test(selNode.outerHTML));ret=ret&&(/height=/i.test(selNode.outerHTML));return ret;};